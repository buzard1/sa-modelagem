<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de Estoque</title>
  <link rel="stylesheet" href="css/sidebar.css">
  <link rel="stylesheet" href="css/estoque.css">
  <link rel="stylesheet" href="css/form.css" />
  <link rel="icon" href="img/logo.png" type="image/png">
</head>
<body>
  <!-- Sidebar fixa -->
  <nav class="sidebar">
    <div class="logo">
      <img src="img/logo.png" alt="Logo do sistema">
    </div>
    <ul class="menu">
      <li><a href="dashboard.html">🏠 <span>Dashboard</span></a></li>
      <li><a href="cadastro-cliente.html">📋 <span>Cadastro Cliente</span></a></li>
      <li><a href="cadastro-pedido.html">🛠️ <span>Cadastro de <br>Ordem de Serviço</span></a></li>
      <li><a href="pedidos.html">💼 <span>Ordem de serviço</span></a></li>
      <li><a href="relatorio.html">📊 <span>Relatórios</span></a></li>
      <li><a href="estoque.html">📦 <span>Estoque</span></a></li>
      <li><a href="usuarios.html">👥 <span>Usuários</span></a></li>
      <li><a href="fornecedor.html">🔗 <span>Fornecedores</span></a></li>
      <li><a href="suporte.html">🆘 <span>Suporte</span></a></li>
      <li><a href="login.html">🚪 <span>Sair</span></a></li>
    </ul>
  </nav>
  <div class="form-container fade-in">
    <h2 class="fade-in delay-1">📦 Controle de Estoque</h2>

    <form class="fade-in delay-2" id="estoqueForm">
      <label for="produto">Nome do Produto</label>
      <input type="text" id="produto" name="produto" placeholder="Ex: Tela Samsung A10" required>

      <label for="quantidade">Quantidade</label>
      <input type="number" id="quantidade" name="quantidade" placeholder="Ex: 10" min="0" required>

      <label for="fornecedor">Fornecedor</label>
      <input type="text" id="fornecedor" name="fornecedor" placeholder="Ex: TechParts" required>

      <label for="valor">Valor Unitário (R$)</label>
      <input type="number" id="valor" name="valor" placeholder="Ex: 80.00" step="0.01" min="0" required>

      <button type="submit" class="btn-login fade-in delay-3">Adicionar ao Estoque</button>
    </form>

    <hr class="fade-in delay-4" style="margin: 2rem 0; border-color: #444;" />

    <input type="text" id="searchInput" placeholder="Buscar produto..." class="search-input fade-in delay-2">

    <h3 class="fade-in delay-4">📋 Itens no Estoque</h3>
    <table class="fade-in delay-5">
      <thead>
        <tr>
          <th>Produto</th>
          <th>Quantidade</th>
          <th>Fornecedor</th>
          <th>Valor (R$)</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Tela iPhone X</td>
          <td>5</td>
          <td>AppleTech</td>
          <td>150.00</td>
          <td><button class="btn-editar">✏️ Editar</button></td>
        </tr>
        <tr>
          <td>Bateria Samsung A10</td>
          <td>12</td>
          <td>SmartParts</td>
          <td>50.00</td>
          <td><button class="btn-editar">✏️ Editar</button></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal de Edição -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Editar Produto</h2>
      <form id="editForm">
        <label for="editProduto">Nome do Produto</label>
        <input type="text" id="editProduto" name="produto" required>

        <label for="editQuantidade">Quantidade</label>
        <input type="number" id="editQuantidade" name="quantidade" min="0" required>

        <label for="editFornecedor">Fornecedor</label>
        <input type="text" id="editFornecedor" name="fornecedor" required>

        <label for="editValor">Valor Unitário (R$)</label>
        <input type="number" id="editValor" name="valor" step="0.01" min="0" required>

        <button type="submit" class="btn-login">Salvar Alterações</button>
      </form>
    </div>
  </div>

  <script>
    // Função de busca
    document.getElementById('searchInput').addEventListener('input', function () {
      const searchValue = this.value.toLowerCase();
      const rows = document.querySelectorAll('tbody tr');
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        const productName = cells[0].textContent.toLowerCase();
        row.style.display = productName.includes(searchValue) ? '' : 'none';
      });
    });

    // Ativa menu atual na sidebar
    const links = document.querySelectorAll('.sidebar .menu li a');
    const currentPage = window.location.pathname.split('/').pop();
    links.forEach(link => {
      if (link.getAttribute('href') === currentPage) {
        link.classList.add('active');
      }
    });

    // Validação do formulário principal
    document.getElementById('estoqueForm').addEventListener('submit', function (event) {
      const quantidade = parseInt(document.getElementById('quantidade').value);
      const valor = parseFloat(document.getElementById('valor').value);
      if (quantidade < 0 || valor < 0) {
        alert("Quantidade e Valor Unitário não podem ser negativos.");
        event.preventDefault();
      }
    });

    // Função do modal de edição
    document.querySelectorAll(".btn-editar").forEach(button => {
      button.addEventListener("click", () => {
        const row = button.closest("tr");
        const cells = row.querySelectorAll("td");

        document.getElementById('editProduto').value = cells[0].textContent;
        document.getElementById('editQuantidade').value = cells[1].textContent;
        document.getElementById('editFornecedor').value = cells[2].textContent;
        document.getElementById('editValor').value = cells[3].textContent;

        const modal = document.getElementById("editModal");
        modal.style.display = "block";

        const span = document.getElementsByClassName("close")[0];
        span.onclick = function () {
          modal.style.display = "none";
        }

        window.onclick = function (event) {
          if (event.target === modal) {
            modal.style.display = "none";
          }
        }

        document.getElementById("editForm").onsubmit = function (e) {
          const editQtd = parseInt(document.getElementById('editQuantidade').value);
          const editVal = parseFloat(document.getElementById('editValor').value);
          if (editQtd < 0 || editVal < 0) {
            alert("Quantidade e Valor Unitário não podem ser negativos.");
            e.preventDefault();
            return;
          }

          e.preventDefault();
          cells[0].textContent = document.getElementById('editProduto').value;
          cells[1].textContent = document.getElementById('editQuantidade').value;
          cells[2].textContent = document.getElementById('editFornecedor').value;
          cells[3].textContent = document.getElementById('editValor').value;
          modal.style.display = "none";
        };
      });
    });
  </script>
</body>
</html>
